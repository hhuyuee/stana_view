/* eslint-disable global-require */
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import '@/plugins/leaflet/provider.china';
import { defaultLeafletIconSize } from '@/config';
// import { defaultLeafletIconSize } from '@/config';
import * as uicApi from '@/api/uic2';
import { convertSvg2Uri, gcj2bd } from '@/util';
import svgicon from '@/assets/icon/svg/blue.svg';

// eslint-disable-next-line no-underscore-dangle
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),
  iconUrl: require('leaflet/dist/images/marker-icon.png'),
  shadowUrl: require('leaflet/dist/images/marker-shadow.png'),
});

// 默认icon draw的时候用到
const iconUrl = convertSvg2Uri(svgicon.content);
const defaultIconOption = { iconUrl, iconSize: defaultLeafletIconSize };
L.Icon.Default.prototype.options = defaultIconOption;

// 全局默认的marker
const defaultIcon = L.icon(defaultIconOption);
L.Marker.prototype.options.icon = defaultIcon;

const selectedMarker = {
  latlng: [],
  address: '', // 选中的点数据
};

export default {
  props: {
    zoom: {
      default: 12,
    },
  },
  data() {
    return {
      map: null,
      center: [39.9, 116.5],
    };
  },
  mounted() {
    this.initMap();
    //this.setMapViewByCode(this.$store.state.selectedCity.code);
  },
  methods: {
    // 初始化地图
    initMap() {
      const option = {
        // crs: L.CRS.Baidu,
        crs: L.CRS.EPSG3857,
        tms: false,
        center: this.center,
        zoom: this.zoom || 15,
        zoomControl: false,
        maxZoom: 18,
        minZoom: 9,
        attributionControl: false,
      };
      this.map = new L.Map(this.$refs.lmap, option);
      var daxing_style = {"version":8,"name":"OSM Liberty","metadata":{"maputnik:renderer":"mbgljs"},"center":[116.38121584163696,39.72704598136738],"zoom":14.130639558830593,"bearing":0,"pitch":1.0000000000000013,"sprite":"http://development04//export/just-studio/icon/testgis/sprite","glyphs":"http://just-test.jd.com/font/{fontstack}/{range}.pbf","sources":{"gsgl":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/942/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"qxm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/898/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"xzm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/888/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"cszgd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/908/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"ggss":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/894/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"gsgl_label":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/944/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"xzm_label":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/943/{z}/{x}/{y}"],"minzoom":0,"maxzoom":14},"ld":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/929/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"cyfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/938/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"cscgd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/911/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"csksl":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/909/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"cszl":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/910/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"czddm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/920/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"dlfsss":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/933/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"dmdzxx":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/905/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"dtx":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/907/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"dtz":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/906/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"fjms":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/937/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"gsqy":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/895/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"gwfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/931/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"gd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/904/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"hbsk":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/924/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"hzzxAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/891/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jzwm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/914/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jtssfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/890/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jtsnAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/889/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jfl":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/930/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jrbxfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/934/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"jqAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/919/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"kjwhfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/927/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"mtcfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/915/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"qcfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/921/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"qcwx":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/922/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"qcxs":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/923/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"qxjdm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/897/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"scAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/903/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"swzz":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/902/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"shfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/925/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"sd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/926/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"sxh":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/901/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"tyxxfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/893/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"tlx":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/936/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"tlzd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/935/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"whcgAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/918/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xxd":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/900/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xcl":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/886/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xzjdjdm":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/887/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xqAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/913/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xzlAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/896/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"xxAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/912/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"ylbjfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/899/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"ydcgAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/932/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"zfjgjshti":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/917/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"zfjgAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/916/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"zsfw":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/892/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14},"zhyyAOI":{"type":"vector","tiles":["http://10.222.54.184:8228/gisserver/tile/87/getTile/dynamic/928/{z}/{x}/{y}"],"minZoom":0,"maxZoom":14}},"layers":[{"id":"qxm","type":"fill","source":"qxm","source-layer":"区县面_AMBqNW1608124870690","metadata":{"just:group":"区域面","just:name_cn":"区县面","just:service_id":248},"minzoom":0,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(14,38, 83,1)"}},{"id":"xzm","type":"fill","source":"xzm","source-layer":"乡镇面_HUESQb1608124866888","metadata":{"just:group":"区域面","just:name_cn":"乡镇面","just:service_id":238},"minzoom":0,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(3,25, 54,1)"}},{"id":"xqAOI","type":"fill","source":"xqAOI","source-layer":"小区AOI_qkzzGK1608124877672","metadata":{"just:group":"区域面","just:name_cn":"小区AOI","just:service_id":263},"minzoom":12,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(1,40, 105,1)"}},{"id":"xzlAOI","type":"fill","source":"xzlAOI","source-layer":"写字楼AOI_AKHuym1608124870437","metadata":{"just:group":"区域面","just:name_cn":"写字楼AOI","just:service_id":246},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(1,40, 105,1)"}},{"id":"ydcgAOI","type":"fill","source":"ydcgAOI","source-layer":"运动场馆AOI_hTOfUx1608124890153","metadata":{"just:group":"区域面","just:name_cn":"运动场馆AOI","just:service_id":282},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)"}},{"id":"zhyyAOI","type":"fill","source":"zhyyAOI","source-layer":"综合医院AOI_FHUmYd1608124886128","metadata":{"just:group":"区域面","just:name_cn":"综合医院AOI","just:service_id":278},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"zfjgAOI","type":"fill","source":"zfjgAOI","source-layer":"政府机关AOI_mwrMBV1608124880542","metadata":{"just:group":"区域面","just:name_cn":"政府机关AOI","just:service_id":266},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"xxAOI","type":"fill","source":"xxAOI","source-layer":"学校AOI_qWLseH1608124877152","metadata":{"just:group":"区域面","just:name_cn":"学校AOI","just:service_id":262},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"jzwm","type":"fill","source":"jzwm","source-layer":"建筑物面_ONtoMV1608124880242","metadata":{"just:group":"区域面","just:name_cn":"建筑物面","just:service_id":264},"minzoom":13,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)"}},{"id":"jqAOI","type":"fill","source":"jqAOI","source-layer":"景区AOI_dGPRid1608124881475","metadata":{"just:group":"区域面","just:name_cn":"景区AOI","just:service_id":269},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(89,142, 106,1)","fill-opacity":0.6}},{"id":"scAOI","type":"fill","source":"scAOI","source-layer":"商场AOI_maBupp1608124872616","metadata":{"just:group":"区域面","just:name_cn":"商场AOI","just:service_id":253},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"hbsk","type":"fill","source":"hbsk","source-layer":"湖泊、水库_WCvKgv1608124882562","metadata":{"just:group":"区域面","just:name_cn":"湖泊、水库","just:service_id":274},"minzoom":0,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(86,136, 181,1)"}},{"id":"jtsnAOI","type":"fill","source":"jtsnAOI","source-layer":"交通枢纽AOI_jGODvV1608124867038","metadata":{"just:group":"区域面","just:name_cn":"交通枢纽AOI","just:service_id":239},"minzoom":13,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(82,125, 255,1)","fill-opacity":0.6}},{"id":"hzzxAOI","type":"fill","source":"hzzxAOI","source-layer":"会展中心AOI_yfhtMX1608124867916","metadata":{"just:group":"区域面","just:name_cn":"会展中心AOI","just:service_id":241},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"whcgAOI","type":"fill","source":"whcgAOI","source-layer":"文化场馆AOI_onCSZE1608124881323","metadata":{"just:group":"区域面","just:name_cn":"文化场馆AOI","just:service_id":268},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"fill-color":"rgba(26,84, 156,1)","fill-opacity":0.6}},{"id":"ld","type":"fill","source":"ld","source-layer":"绿地_sHsYxQ1608124887661","metadata":{"just:group":"区域面","just:name_cn":"绿地","just:service_id":279},"minzoom":0,"maxzoom":22,"paint":{"fill-color":"rgba(4,105, 54,1)"}},{"id":"gsgl","type":"line","source":"gsgl","source-layer":"高速公路_FWgfwq1608169597122","metadata":{"just:group":"道路线","just:name_cn":"高速公路","just:service_id":295},"minzoom":11,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)","line-width":5}},{"id":"gd","type":"line","source":"gd","source-layer":"国道_zYnPFj1608124872778","metadata":{"just:group":"道路线","just:name_cn":"国道","just:service_id":254},"minzoom":0,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)","line-width":4}},{"id":"sd","type":"line","source":"sd","source-layer":"省道_oBhSYC1608124884986","metadata":{"just:group":"道路线","just:name_cn":"省道","just:service_id":276},"minzoom":6,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)","line-width":3}},{"id":"xxd","type":"line","source":"xxd","source-layer":"县乡道_evzEmY1608124871765","metadata":{"just:group":"道路线","just:name_cn":"县乡道","just:service_id":250},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)","line-width":2}},{"id":"xcl","type":"line","source":"xcl","source-layer":"乡村路_qDaSbN1608124866516","metadata":{"just:group":"道路线","just:name_cn":"乡村路","just:service_id":236},"minzoom":15,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"tlx","type":"line","source":"tlx","source-layer":"铁路线_QlTELE1608124891033","metadata":{"just:group":"道路线","just:name_cn":"铁路线","just:service_id":286},"minzoom":13,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"sxh","type":"line","source":"sxh","source-layer":"双线河_fOcTUN1608124871918","metadata":{"just:group":"道路线","just:name_cn":"双线河","just:service_id":251},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"dtx","type":"line","source":"dtx","source-layer":"地铁线_NNqhBm1608124874595","metadata":{"just:group":"道路线","just:name_cn":"地铁线","just:service_id":257},"minzoom":13,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"jfl","type":"line","source":"jfl","source-layer":"街坊路_dhJXeX1608124888846","metadata":{"just:group":"道路线","just:name_cn":"街坊路","just:service_id":280},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"csksl","type":"line","source":"csksl","source-layer":"城市快速路_QzOFut1608124875003","metadata":{"just:group":"道路线","just:name_cn":"城市快速路","just:service_id":259},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"cszl","type":"line","source":"cszl","source-layer":"城市支路_yETfmB1608124876284","metadata":{"just:group":"道路线","just:name_cn":"城市支路","just:service_id":260},"minzoom":14,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"cszgd","type":"line","source":"cszgd","source-layer":"城市主干道_RtUoPO1608124874845","metadata":{"just:group":"道路线","just:name_cn":"城市主干道","just:service_id":258},"minzoom":0,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26, 80, 163, 1)","line-width":2}},{"id":"cscgd","type":"line","source":"cscgd","source-layer":"城市次干道_jMpRXs1608124876544","metadata":{"just:group":"道路线","just:name_cn":"城市次干道","just:service_id":261},"minzoom":13,"maxzoom":22,"layout":{"visibility":"visible"},"paint":{"line-color":"rgba(26,80, 163,1)"}},{"id":"ggss_symbol","type":"symbol","source":"ggss","source-layer":"公共设施_hrEibL1608124868983","metadata":{"just:group":"兴趣点","just:name_cn":"公共设施","just:service_id":244},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"jtssfw_symbol","type":"symbol","source":"jtssfw","source-layer":"交通设施服务_VRMKHn1608124867767","metadata":{"just:group":"兴趣点","just:name_cn":"交通设施服务","just:service_id":240},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"mtcfw_symbol","type":"symbol","source":"mtcfw","source-layer":"摩托车服务_XsfomM1608124880379","metadata":{"just:group":"兴趣点","just:name_cn":"摩托车服务","just:service_id":265},"minzoom":16,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"qcfw_symbol","type":"symbol","source":"qcfw","source-layer":"汽车服务_fTjaDv1608124882130","metadata":{"just:group":"兴趣点","just:name_cn":"汽车服务","just:service_id":271},"minzoom":16,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"qcwx_symbol","type":"symbol","source":"qcwx","source-layer":"汽车维修_CemIDE1608124882273","metadata":{"just:group":"兴趣点","just:name_cn":"汽车维修","just:service_id":272},"minzoom":16,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"qcxs_symbol","type":"symbol","source":"qcxs","source-layer":"汽车销售_kCVrwS1608124882416","metadata":{"just:group":"兴趣点","just:name_cn":"汽车销售","just:service_id":273},"minzoom":16,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"kjwhfw_symbol","type":"symbol","source":"kjwhfw","source-layer":"科教文化服务_rZyHTR1608124885990","metadata":{"just:group":"兴趣点","just:name_cn":"科教文化服务","just:service_id":277},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"gsqy_symbol","type":"symbol","source":"gsqy","source-layer":"公司企业_prkfPV1608124870282","metadata":{"just:group":"兴趣点","just:name_cn":"公司企业","just:service_id":245},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"jrbxfw_symbol","type":"symbol","source":"jrbxfw","source-layer":"金融保险服务_zohnFc1608124890779","metadata":{"just:group":"兴趣点","just:name_cn":"金融保险服务","just:service_id":284},"minzoom":14,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"zsfw_symbol","type":"symbol","source":"zsfw","source-layer":"住宿服务_fxXSGi1608124868433","metadata":{"just:group":"兴趣点","just:name_cn":"住宿服务","just:service_id":242},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":10},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"gwfw_symbol","type":"symbol","source":"gwfw","source-layer":"购物服务_JEXNVu1608124890025","metadata":{"just:group":"兴趣点","just:name_cn":"购物服务","just:service_id":281},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":10,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"tyxxfw_symbol","type":"symbol","source":"tyxxfw","source-layer":"体育休闲服务_xQOLkB1608124868742","metadata":{"just:group":"兴趣点","just:name_cn":"体育休闲服务","just:service_id":243},"minzoom":14,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"cyfw_symbol","type":"symbol","source":"cyfw","source-layer":"餐饮服务_JqVjLj1608124892026","metadata":{"just:group":"兴趣点","just:name_cn":"餐饮服务","just:service_id":288},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":10},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"shfw_symbol","type":"symbol","source":"shfw","source-layer":"生活服务_TrVYrL1608124884507","metadata":{"just:group":"兴趣点","just:name_cn":"生活服务","just:service_id":275},"minzoom":14,"maxzoom":22,"layout":{"visibility":"none"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"ylbjfw_symbol","type":"symbol","source":"ylbjfw","source-layer":"医疗保健服务_gpRnqx1608124871252","metadata":{"just:group":"兴趣点","just:name_cn":"医疗保健服务","just:service_id":249},"minzoom":14,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"swzz_symbol","type":"symbol","source":"swzz","source-layer":"商务住宅_WEhKNo1608124872478","metadata":{"just:group":"兴趣点","just:name_cn":"商务住宅","just:service_id":252},"minzoom":16,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":14,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"dtz_symbol","type":"symbol","source":"dtz","source-layer":"地铁站_QCCSyC1608124874465","metadata":{"just:group":"兴趣点","just:name_cn":"地铁站","just:service_id":256},"minzoom":13,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"tlzd_symbol","type":"symbol","source":"tlzd","source-layer":"铁路站点_mrZzQF1608124890908","metadata":{"just:group":"兴趣点","just:name_cn":"铁路站点","just:service_id":285},"minzoom":13,"maxzoom":22,"layout":{"text-size":12,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"fjms_symbol","type":"symbol","source":"fjms","source-layer":"风景名胜_QIMovN1608124891176","metadata":{"just:group":"兴趣点","just:name_cn":"风景名胜","just:service_id":287},"minzoom":13,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"czddm_symbol","type":"symbol","source":"czddm","source-layer":"村庄点地名_sYPuqx1608124881629","metadata":{"just:group":"兴趣点","just:name_cn":"村庄点地名","just:service_id":270},"minzoom":15,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":10},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"dmdzxx_symbol","type":"symbol","source":"dmdzxx","source-layer":"地名地址信息_KsbSvf1608124874331","metadata":{"just:group":"兴趣点","just:name_cn":"地名地址信息","just:service_id":255},"minzoom":16,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"zfjgjshti_symbol","type":"symbol","source":"zfjgjshti","source-layer":"政府机构及社会团体_PBGGQZ1608124881189","metadata":{"just:group":"兴趣点","just:name_cn":"政府机构及社会团体","just:service_id":267},"minzoom":13,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"dlfsss_symbol","type":"symbol","source":"dlfsss","source-layer":"道路附属设施_VJKjDf1608124890592","metadata":{"just:group":"兴趣点","just:name_cn":"道路附属设施","just:service_id":283},"minzoom":16,"maxzoom":22,"layout":{"text-anchor":"top","text-offset":[0,1],"icon-image":"39","text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"gsgl_label","type":"symbol","source":"gsgl_label","source-layer":"高速公路label_ssrDIT1608172806828","metadata":{"just:group":"标注","just:name_cn":"高速公路","just:type":"label","just:service_id":297},"minzoom":12,"maxzoom":22,"layout":{"text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":16,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"qxjdm_label","type":"symbol","source":"qxjdm","source-layer":"区县级地名_ahpPmZ1608124870565","metadata":{"just:group":"标注","just:name_cn":"区县级地名","just:type":"label","just:service_id":247},"minzoom":12,"maxzoom":22,"layout":{"text-size":14,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"xzjdjdm_label","type":"symbol","source":"xzjdjdm","source-layer":"乡镇街道级地名_jIHzhZ1608124866693","metadata":{"just:group":"标注","just:name_cn":"乡镇街道级地名","just:type":"label","just:service_id":237},"minzoom":14,"maxzoom":22,"layout":{"text-field":["to-string",["get","NAME"]],"text-font":["literal",["msyh"]],"text-size":12,"visibility":"visible"},"paint":{"text-color":"rgba(163,192, 255,1)"}},{"id":"xzm_label","type":"symbol","source":"xzm_label","source-layer":"乡镇面label_QHGTgv1608171844814","metadata":{"just:group":"标注","just:name_cn":"乡镇面","just:type":"label","just:service_id":296},"minzoom":14,"maxzoom":22,"layout":{"text-field":["get","NAME"],"text-font":["literal",["msyh"]],"text-size":12},"paint":{"text-color":"rgba(163,192, 255,1)"}}]};
      L.control.layers(
        {
          // 百度地图: L.tileLayer.chinaProvider(mapType).addTo(this.map),
          腾讯地图: new L.TencentLayer('ROADMAP').addTo(this.map),
          卫星地图: new L.TencentLayer('SATELLITE'),
          JUST地图: L.mapboxGL({
              style: daxing_style,
              accessToken: "pk.eyJ1IjoiejM2MjgzMTU2MSIsImEiOiJjajVkaml6Z3EwcDFiMndsZGFxZjFyc3FpIn0.NkyQqYkspi-AtxuR7gkZOg",
              //开启事件交互
              interactive: true
          })
        },
        {},
        {
          position: 'bottomleft'
        }
      ).addTo(this.map);
      // this.tileLayer = L.tileLayer.chinaProvider(mapType);
      // this.tileLayer.addTo(this.map);
      this.$emit('load', this.map);
      // L.control.layers(
      //   {
      //     // "百度地图": L.tileLayer.baidu({ layer: 'custom', customid: 'grayscale' }),
      //     '高德地图': L.M.Gaode,
      //     // "腾讯地图": new L.TencentLayer('ROADMAP'),
      //     '卫星地图': L.M.Gaode
      //   },
      //   {},
      //   {
      //     position: 'bottomleft'
      //   }
      // ).addTo(this.map);
    },
    /**
     * 根据城市code移动地图
     */
    async setMapViewByCode(code, fly) {
      const {
        properties: {
          center: { lat, lng },
        },
      } = await uicApi.getCountryGeojson(code);
      const bdLatLng = gcj2bd([lng, lat]).reverse();
      const flyOpt = { duration: 5.0 };
      const flyParams = [L.latLng(bdLatLng), undefined, flyOpt];
      // eslint-disable-next-line no-unused-expressions
      fly ? this.map.flyTo(...flyParams) : this.map.setView(...flyParams);
    },
    /**
     * 清除所有图层
     */
    clearLayer() {
      this.map.eachLayer((layer) => {
        if (layer !== this.tileLayer) {
          this.map.removeLayer(layer);
        }
      });
    },
    /**
     * 清空地图状态
     */
    clearMap() {
      // 清空地图上render的区域
      // eslint-disable-next-line no-unused-expressions
      this.selectedAreaLayer && this.selectedAreaLayer.clearLayers(); // 清空区域
      // eslint-disable-next-line no-unused-expressions
      this.selectedMarkerLayer && this.selectedMarkerLayer.clearLayers(); // 清空marker
      // eslint-disable-next-line no-unused-expressions
      this.comparedAreasLayers && this.comparedAreasLayers.clearLayers(); // 清空对比图
      // 清空选择的区域和地点
      this.selectedArea = {};
      this.selectedAreaNameList = '';
      this.selectedMarker = selectedMarker;
    },
  },
};
